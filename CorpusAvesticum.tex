\ProvidesFile{CorpusAvesticum.tex}[2019/11/28 v0.17BETA Configuration file for 
brill]
\RequirePackage{xstring}
\RequirePackage{newunicodechar}
\RequirePackage{luacode}
\begin{luacode*}
   function modifySorting()
      local f = io.open("passages.idx", "r+")
      local content = f:read("*all")
      f:seek('set')
      content = string.gsub(content, "\\gls {([^}]*)}~?(%d+)%.(%d+)",
      function(a,b,c) return
         string.format("%s%03d.%03d@%s~%d.%d", a, b, c, a, b, c) end)
      f:write(content)
      f:close()
   end
   
   -- see if the file exists
   function file_exists(file)
     local f = io.open(file, "rb")
     if f then f:close() end
     return f ~= nil
   end
   
   -- get all lines from a file, returns an empty 
   -- list/table if the file does not exist
   function lines_from(file)
     if not file_exists(file) then return {} end
     lines = {}
     for line in io.lines(file) do 
       lines[#lines + 1] = line
     end
     return lines
   end
   
   function sortGlossary()
      -- tests the functions above
      local file = 'dictionary.tex'
      local outfile = 'dictionaryconv.tex'
      
      if not file_exists(file) then return {} end
      
      local lines = lines_from(file)
      local text = ""
      local str = ""
      local prevlemma = ""
      local lemma = ""
      local lemmacontent = ""
      local result = {}
      local newkeys = {}
      local inDictionary = false
      local f = assert(io.open(outfile, "w+"))
      
      for k,v in pairs(lines) do
         -- get line k and process it
         local str = lines[k]
         
         if string.match(str, "^\\begin{Dictionary}") then
            f:write('\\begin{ModDictionary}', "\n")
            inDictionary = true
         elseif string.match(str, "^\\end{Dictionary}") then
            -- we reached the end of the dictionary
            -- write last lemma to file
            if prevlemma and prevlemma ~= '' then
               result[prevlemma] = lemmacontent
            end
            -- start sorting process
            newkeys = sortLemma(result)
            -- use the keys to retrieve the values in the sorted order
            for _, k in ipairs(newkeys) do
               f:write('\n\\Lemma{' .. k .. '}' .. result[k])
            end
            -- if lines follow they should be processed as well
            f:write('\n\\end{ModDictionary}', "\n")
            inDictionary = false
         end              
         if inDictionary == false then
--            if str ~= '\\end{Dictionary}' then
--               f:write(str, "\n")
--            end
         else
            lemma, text = string.match(str, "^\\Lemma{(.-)}(.*)$") --$
            if lemma and lemma ~= '' then
            -- we found a new lemma
            -- write previous lemma (if any) to table
               if prevlemma and prevlemma ~= '' then
                  result[prevlemma] = lemmacontent
               end
            -- remember new lemma as prevlemma for next entry
               prevlemma = lemma
               lemmacontent = text
            else
               lemmacontent = lemmacontent .. "\n" .. str
            end
         end
      end
      f:close()
   end
   
   function sortLemma (t)
      local tkeys = {}
      -- populate the table that holds the keys
      for k in pairs(t) do table.insert(tkeys, k) end
      -- sort the keys
      table.sort(tkeys, compare)
      return tkeys
   end
   
   function compare (a,b)
      -- before sorting, we remove dashes at the end
      local s1 = string.gsub(a, '-$', '')--$
      local s2 = string.gsub(b, '-$', '')--$
      local so1, so2
      
      -- texio.write_nl('Compare ' .. s1 .. ' with ' .. s2)
      -- if both strings are equal we stop processing
      if s1 ~= s2 then
      -- as long as both strings have equal characters (and are both not empty)
      -- get the next sorting letter and compare them
         while s1 ~= '' and s2 ~= '' do
            -- texio.write_nl('Vorher: ' .. s1 .. ' ' .. s2)
            so1, s1 = sortletter(s1)
            so2, s2 = sortletter(s2)
            -- texio.write_nl('Sort order: ' .. so1 .. ' ' .. so2)
            -- texio.write_nl('Rest: ' .. s1 .. ' ' .. s2)
            if so1 < so2 then
               return true
            elseif so1 > so2 then
               return false
            end
            -- texio.write_nl('Nachher: ' .. s1 .. ' ' .. s2)
         end
         if s1 == '' then
            return true
         else
            return false
         end
      else
         return false
      end
   end
   
   function sortletter (s)
      local gujorder = {["a"] = 1, ["ā"] = 2, ["i"] = 3, ["ī"] = 4,["u"] = 5,
      ["ū"] = 6, ["r̥"] = 7, ["e"] = 8, ["o"] = 9, ["ṃ"] = 10, ["k"] = 11, 
      ["kh"] = 12, ["g"] = 13, ["gh"] = 14, ["ṅ"] = 15, ["c"] = 16, ["ch"] = 17,
      ["j"] = 18, ["jh"] = 19, ["ñ"] = 20, ["ṭ"] = 21, ["ṭh"] = 22,
      ["ḍ"] = 23, ["ḍh"] = 24, ["ṇ"] = 25, ["t"] = 26, ["th"] = 27, ["d"] = 28, 
      ["dh"] = 29, ["n"] = 30, ["p"] = 31, ["ph"] = 32, ["f"] = 33, ["b"] = 34,
      ["bh"] = 35, ["m"] = 36, ["y"] = 37, ["r"] = 38, ["l"] = 39, ["v"] = 40,
      ["ś"] = 41, ["ṣ"] = 42,["s"] = 43, ["h"] = 44, ["ḷ"] = 45}   
      local sortletter = ''
      
      -- If s is at last two characters long, we check, whether the first two 
      -- characters form a valid sorting letter (according to our scheme)
      if string.len(s) > 1 then
         sortletter = string.sub(s,1,2)
         if gujorder[sortletter] == nil then
            sortletter = string.sub(s,1,1)
         end
      else -- otherwise just take the first character and check
         sortletter = string.sub(s,1,1)   
      end
      -- texio.write_nl(s .. ' ' .. sortletter .. ' ' .. string.len(sortletter))
      if gujorder[sortletter] then
         return gujorder[sortletter], string.sub(s, string.len(sortletter) + 1)
      else -- if there is a letter we don't know, insert at the very end
         return 99, string.sub(s, string.len(sortletter) + 1)
      end
   end
\end{luacode*}
%\LuaCodeDebugOn
\patchcmd{\imki@putindex}%
   {\immediate\closeout\csname #1@idxfile\endcsname}%
   {\immediate\closeout\csname #1@idxfile\endcsname
    \ifstr{#1}{passages}{%
      \ClassInfo{brill}{Start modifying passages for sorting ...}%
      \directlua{modifySorting()}%
      \ClassInfo{brill}{... done.}%
    }{}}%
   {\ClassInfo{brill}{\string\imki@putindex\space successfully patched!}}%
   {\ClassInfo{brill}{\string\imki@putindex\space could not be patched!}}%
\newcommand{\printindexes}{%
   \begingroup
      \renewcommand*{\subitem}{\par\hangindent 2\normalparindent}%
      \printindex[words]
      \printindex[passages]
   \endgroup
   \printindex[namesandsubjects]
}
\makeindex[%
   name=words,%
   title={Index of Words},%
   columns=2,%
   columnsep=4mm,%
   options={--noheadings --config muya}   
   ]%
\makeindex[%
   name=passages,%
   title={Index of Passages},%
   %intoc,%
   columns=2,%
   columnsep=4mm,%
   %options={-s muya.ist}%
   options={--noheadings --config muya}
   ]%
\makeindex[%
   name=namesandsubjects,%
   title={Index of Names and Subjects},%
   %intoc,%
   columns=2,%
   columnsep=4mm,%
   options={--noheadings --config brill}
   ]%
\protected\def\Word{\@ifstar{\@indexwords}{\@dblarg\@@indexwords}}
\newcommand{\@indexwords}[1]{%
   \StrCut*{#1}{!}{\@leftword}{\@rightword}%
   \ifstrempty{\@rightword}%
      {\index[words]{\indexlanguage!#1@\idxentryfont{#1}}}%
      {\index[words]{\indexlanguage!#1@\idxentryfont{\@rightword}}}%
}%
\newcommand{\@@indexwords}[2][]{%
   \StrCut*{#1}{!}{\@leftword}{\@rightword}%
   \ifstrempty{\@rightword}%
      {\index[words]{\indexlanguage!#1@\idxentryfont{#1}}#2\index[words]{\indexlanguage!#1@\idxentryfont{#1}}}%
      {\index[words]{\indexlanguage!#1@\idxentryfont{#1}}#2\index[words]{\indexlanguage!#1@\idxentryfont{#1}}}%
}%

\protected\def\Passage{\@ifstar{\@indexpassages}{\@dblarg\@@indexpassages}}
\newcommand{\@indexpassages}[1]{\index[passages]{\indexlanguage!#1@\textup{#1}}}
\newcommand{\@@indexpassages}[2][]{%
   \index[passages]{\indexlanguage!#1}\textup{#2}\index[passages]{\indexlanguage!#1}%
}%

\protected\def\Name{\@ifstar{\@indexnamesandsubjects}{\@dblarg\@@indexnamesandsubjects}}
\protected\def\Subject{\@ifstar{\@indexnamesandsubjects}{\@dblarg\@@indexnamesandsubjects}}
\newcommand{\@indexnamesandsubjects}[1]{\index[namesandsubjects]{#1}}
\newcommand{\@@indexnamesandsubjects}[2][]{\index[namesandsubjects]{#1}#2}

\let\passage\Passage
\let\subject\Subject
\let\name\Name
\let\word\Word

\newcommand*{\indexlanguage}{A@General}
\newcommand*{\idxentryfont}[1]{#1}
\newcommand*{\resetlanguage}{\gdef\indexlanguage{A@General}\renewcommand*{\idxentryfont}[1]{##1}}
\newcommand{\ItalicsOrNot}[1]{%
   \IfStrEqCase{#1}{%
      {Arm}{\def\indexlanguage{U@Armenian}\itshape}%
      {Av}{\def\indexlanguage{B@Avestan}\itshape}%
      {Bactr}{\def\indexlanguage{F@Bactrian}\upshape}%
      {Chor}{\def\indexlanguage{G@Choresmian}\upshape}%
      {El}{\def\indexlanguage{V@Elamite}\itshape}%
      {NP}{\def\indexlanguage{E@New Persian}\itshape}%
      {Goth}{\def\indexlanguage{W@Gothic}\itshape}%
      {Grk}{\def\indexlanguage{M@Greek}\upshape}%
      {Guj}{\def\indexlanguage{X@Gujarati}\itshape}%
      {IE}{\def\indexlanguage{O@Indo-European}\itshape}%
      {IIr}{\def\indexlanguage{L@Indo-Iranian}\itshape}%
      {Khot}{\def\indexlanguage{H@Khotanese}\itshape}%
      {Lat}{\def\indexlanguage{N@Latin}\itshape}%
      {OE}{\def\indexlanguage{ZZ@Old English}\itshape}%
      {OHG}{\def\indexlanguage{ZA@Old High German}\itshape}%
      {OP}{\def\indexlanguage{C@Old Persian}\itshape}%
      {Oss}{\def\indexlanguage{I@Ossetic}\itshape}%
      {Parth}{\def\indexlanguage{O@Parthian}\upshape}%
      {PGmc}{\def\indexlanguage{ZB@Proto-Germanic}\itshape}%
      {Phl}{\def\indexlanguage{DB@Pahlavi}\itshape}%
      {PrIr}{\def\indexlanguage{P@Proto Iranian}\itshape}%
      {Pli}{\def\indexlanguage{Q@PāỊi}\itshape}%
      {Pra}{\def\indexlanguage{R@Prakrit}\itshape}%
      {Pz}{\def\indexlanguage{S@Pāzand}\itshape}%
      {Skt}{\def\indexlanguage{TA@Sanskrit}\itshape}%
      {Sogd}{\def\indexlanguage{J@Sogdian}\itshape}%
      {Ved}{\def\indexlanguage{TB@Vedic}\itshape}%
      {ZD}{\def\indexlanguage{ZC@Zoroastrian Dari}\itshape}%
   }[\def\indexlanguage{A@General}\upshape]%
   \hyphenpenalty=10000%
}
%%% Define macros for languages
\newcommand*{\Arm}[2][]{%
   \def\indexlanguage{U@Armenian}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\protected\def\Av{\@ifstar\@Av\@@Av}
\newcommand*{\@Av}[2][]{%
   \def\indexlanguage{B@Avestan}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \Word[#2]{\emph{#2}}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\@@Av}[2][]{%
   \def\indexlanguage{B@Avestan}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\Avst\Av   
\newcommand*{\Bactr}[2]{%
   \def\indexlanguage{F@Bactrian}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Chor}[2][]{%
   \def\indexlanguage{G@Choresmian}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\El}[2][]{%
   \def\indexlanguage{V@Elamite}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\NP}[2][]{%
   \def\indexlanguage{E@New Persian}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\Fa\NP   
\newcommand*{\Goth}[2][]{%
   \def\indexlanguage{W@Gothic}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Grk}[2][]{%
   \def\indexlanguage{M@Greek}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Guj}[2][]{%
   \def\indexlanguage{X@Gujarati}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\Gujr\Guj   
\newcommand*{\IE}[2][]{%
   \def\indexlanguage{O@Indo-European}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\IIr}[2][]{%
   \def\indexlanguage{L@Indo-Iranian}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Khot}[2][]{%
   \def\indexlanguage{H@Khotanese}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Lat}[2][]{%
   \def\indexlanguage{N@Latin}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\OE\@undefined
\newcommand*{\OE}[2][]{%
   \def\indexlanguage{ZZ@Old English}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\OHG}[2][]{%
   \def\indexlanguage{ZA@Old High German}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\OP}[2][]{%
   \@ifnextchar\bgroup{\@OP[#1]{#2}}{\@OP[#1]{#2}{}}}
\newcommand*{\@OP}[3][]{%
   \def\indexlanguage{C@Old Persian}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \textit{#2}%
   \ifstrempty{#3}{}{\ [#3]}%
   \ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage
   \@ifnextchar ,{}{\@ifnextchar .{}{\ }}}  
\newcommand*{\OPtlt}[2][]{%
   \def\indexlanguage{DA@Old Persian}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}   
\newcommand*{\Oss}[2][]{%
   \def\indexlanguage{I@Ossetic}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Parth}[2][]{%
   \def\indexlanguage{O@Parthian}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\PGmc}[2][]{%
   \def\indexlanguage{ZB@Proto-Germanic}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Phl}[2][]{%
   \@ifnextchar\bgroup{\@Phl[#1]{#2}}{\@Phl[#1]{#2}{}}}
\newcommand*{\@Phl}[3][]{%
   \def\indexlanguage{DB@Pahlavi}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \textit{#2}%
   \ifstrempty{#3}{}{\ [#3]}%
   \ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage
   \@ifnextchar ,{}{\@ifnextchar .{}{\ }}}
\let\Phlv\Phl   
\newcommand*{\Phltlt}[2][]{%
   \def\indexlanguage{DA@Pahlavi}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\Phlvtlt\Phltlt
\newcommand*{\PrIr}[2][]{%
   \def\indexlanguage{P@Proto Iranian}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\PIr\PrIr
\newcommand*{\Pli}[2][]{%
   \def\indexlanguage{Q@PāỊi}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Pra}[2][]{%
   \def\indexlanguage{R@Prakrit}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Pz}[2][]{%
   \def\indexlanguage{S@Pāzand}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Skt}[2][]{%
   \def\indexlanguage{TA@Sanskrit}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\Sa\Skt   
\newcommand*{\Sogd}[2][]{%
   \def\indexlanguage{J@Sogdian}%
   \renewcommand*{\idxentryfont}[1]{##1}%
   #2\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newcommand*{\Ved}[2][]{%
   \def\indexlanguage{TB@Vedic}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\let\VedSa\Ved
\newcommand*{\ZD}[2][]{%
   \def\indexlanguage{ZC@Zoroastrian Dari}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}%
   \emph{#2}\ifstrempty{#1}{}{\ \enquote{#1}}%
   \resetlanguage}
\newenvironment{ArmBlock}{\def\indexlanguage{U@Armenian}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{AvBlock}{\def\indexlanguage{B@Avestan}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\AvstBlock\AvBlock
\let\endAvstBlock\endAvBlock
\newenvironment{BactrBlock}{\def\indexlanguage{F@Bactrian}\renewcommand*{\idxentryfont}[1]{##1}}{\resetlanguage}
\newenvironment{ChorBlock}{\def\indexlanguage{G@Choresmian}\renewcommand*{\idxentryfont}[1]{##1}}{\resetlanguage}
\newenvironment{ElBlock}{\def\indexlanguage{V@Elamite}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{NPBlock}{\def\indexlanguage{E@New 
Persian}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\FaBlock\NPBlock
\let\endFaBlock\endNPBlock
\newenvironment{GothBlock}{\def\indexlanguage{W@Gothic}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{GrkBlock}{\def\indexlanguage{M@Greek}\renewcommand*{\idxentryfont}[1]{##1}}{\resetlanguage}
\newenvironment{GujBlock}{\def\indexlanguage{X@Gujarati}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\GujrBlock\GujBlock
\let\endGujrBlock\endGujBlock
\newenvironment{IEBlock}{\def\indexlanguage{O@Indo-European}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{IIrBlock}{\def\indexlanguage{L@Indo-Iranian}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{KhotBlock}{\def\indexlanguage{H@Khotanese}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{LatBlock}{\def\indexlanguage{N@Latin}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{OEBlock}{%
   \def\indexlanguage{ZZ@Old English}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{OHGBlock}{%
   \def\indexlanguage{ZA@Old High German}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{OPBlock}{\def\indexlanguage{C@Old 
Persian}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{OssBlock}{\def\indexlanguage{I@Ossetic}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{ParthBlock}{\def\indexlanguage{O@Parthian}\renewcommand*{\idxentryfont}[1]{##1}}{\resetlanguage}
\newenvironment{PGmcBlock}{\def\indexlanguage{ZB@Proto-Germanic}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{PhlBlock}{\def\indexlanguage{DB@Pahlavi}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{PhltltBlock}{\def\indexlanguage{DA@Pahlavi}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\PhlvBlock\PhlBlock
\let\endPhlvBlock\endPhlBlock
\let\PhlvtltBlock\PhltltBlock
\let\endPhlvtltBlock\endPhltltBlock
\newenvironment{PrIrBlock}{\def\indexlanguage{P@Proto 
Iranian}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{}	
\let\PIrBlock\PrIrBlock
\let\endPIrBlock\endPrIrBlock
\newenvironment{PliBlock}{\def\indexlanguage{Q@PāỊi}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{PraBlock}{\def\indexlanguage{R@Prakrit}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{PzBlock}{\def\indexlanguage{S@Pāzand}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\newenvironment{SkrBlock}{\def\indexlanguage{TA@Sanskrit}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\SaBlock\SkrBlock
\let\endSaBlock\endSkrBlock
\newenvironment{SogdBlock}{\def\indexlanguage{J@Sogdian}\renewcommand*{\idxentryfont}[1]{##1}}{\resetlanguage}
\newenvironment{VedBlock}{\def\indexlanguage{TB@Vedic}\renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
\let\VedSaBlock\VedBlock
\let\endVedSaBlock\endVedBlock
\newenvironment{ZDBlock}{%
   \def\indexlanguage{ZC@Zoroastrian Dari}%
   \renewcommand*{\idxentryfont}[1]{\textit{##1}}\itshape}{\resetlanguage}
%%%

\newcommand{\Fr}[1]{\foreignlanguage{french}{#1}}
\newcommand{\Ger}[1]{\foreignlanguage{ngerman}{#1}}
\newenvironment{FrBlock}{\begin{otherlanguage*}{french}}{\end{otherlanguage*}}
\newenvironment{GerBlock}{\begin{otherlanguage*}{ngerman}}{\end{otherlanguage*}}

\newcommand*{\A}[1]{\gls{A}\nobreakspace{}#1}% Afrinagan
\newcommand*{\ABu}[1]{\gls{ABu}\nobreakspace{}#1}% Afrin i Buzorgan
\newcommand*{\AD}[1]{\gls{AD}\nobreakspace{}#1}% Afrin i Dahman
\newcommand*{\AG}[1]{\gls{AG}\nobreakspace{}#1}% Afrin i Gahambar
\newcommand*{\Ank}[1]{\gls{Ank}\nobreakspace{}#1}% 
\newcommand*{\As}[1]{\gls{As}\nobreakspace{}#1}% Asirvad
\newcommand*{\AvAlph}[1]{\gls{AvAlph}\nobreakspace{}#1}% Avestan alphabet
\newcommand*{\Col}[1]{\gls{Col}\nobreakspace{}#1}% Colophon
\newcommand*{\DrYt}[1]{\gls{DrYt}\nobreakspace{}#1}% Drōn Yašt
\newcommand*{\DuP}[1]{\gls{DuP}\nobreakspace{}#1}% Du&#702;a Paymani
\newcommand*{\FiO}[1]{\gls{FiO}\nobreakspace{}#1}% Frahang i Oim
\newcommand*{\FrW}[1]{\gls{FrW}\nobreakspace{}#1}% Fragment Westergard
\newcommand*{\Gah}[1]{\gls{G}\nobreakspace{}#1}% Gah
\let\H\@undefined
\newcommand*{\H}[1]{\gls{H}\nobreakspace{}#1}% Herbedestan
\let\Herbedestan\H
\newcommand*{\Hb}[1]{\gls{Hb}\nobreakspace{}#1}% Hosbam
\let\HB\Hb
\newcommand*{\HN}[1]{\gls{HN}\nobreakspace{}#1}% Hadoxt Nask
\newcommand*{\N}[1]{\gls{N}\nobreakspace{}#1}% Nerangestan
\newcommand*{\NiAb}[1]{\gls{NiAb}\nobreakspace{}#1}% Nērang-ī āb ud padyāb
\newcommand*{\NiAs}[1]{\gls{NiAs}\nobreakspace{}#1}% Nirang Asoan
\newcommand*{\Nirang}[1]{\gls{Nirang}\nobreakspace{}#1}% Nirang
\newcommand*{\NiSY}[1]{\gls{NiSY}\nobreakspace{}#1}% Nirang Sangriza Yastan
\newcommand*{\NkB}[1]{\gls{NkB}\nobreakspace{}#1}% Nerang i kustig bastan
\newcommand*{\NS}[1]{\gls{NS}\nobreakspace{}#1}% Nam Stayisn
\newcommand*{\Ny}[1]{\gls{Ny}\nobreakspace{}#1}% Nyayisn
\newcommand*{\Par}[1]{\gls{Par}\nobreakspace{}#1}% Paragna
\newcommand*{\PaIr}[1]{\gls{PaIr}\nobreakspace{}#1}% Patet Irani
\newcommand*{\PaPas}[1]{\gls{PaPas}\nobreakspace{}#1}% Patet Pasemanih
\newcommand*{\PaXw}[1]{\gls{PaXw}\nobreakspace{}#1}% Patet Xwad
\newcommand*{\PazT}[1]{\gls{PazT}\nobreakspace{}#1}% Pazand texts
\newcommand*{\PPhl}[1]{\gls{PPhl}\nobreakspace{}#1}% Payman i Pahlawi
\newcommand*{\PS}[1]{\gls{PS}\nobreakspace{}#1}% Payman i Sanskrit
\newcommand*{\PV}[1]{\gls{PV}\nobreakspace{}#1}% Pahlavi Vidēvdād
\newcommand*{\PVr}[1]{\gls{PVr}\nobreakspace{}#1}% Pahlavi Visperad
\newcommand*{\PY}[1]{\gls{PY}\nobreakspace{}#1}% Pahlavi Yasna
\newcommand*{\PYt}[1]{\gls{PYt}\nobreakspace{}#1}% Pahlavi version of Yašt
\let\S\@undefined
\newcommand*{\S}[1]{\gls{S}\nobreakspace{}#1}% Siroza
\let\Siroza\S
\newcommand*{\SrB}[1]{\gls{SrB}\nobreakspace{}#1}% Sros Baj
\newcommand*{\SY}[1]{\gls{SY}\nobreakspace{}#1}% Sanskrit Yasna
\newcommand*{\SYt}[1]{\gls{SYt}\nobreakspace{}#1}% Sanskrit version of Yašt
\newcommand*{\Vd}[1]{\gls{Vd}\nobreakspace{}#1}% Videvdad
\let\V\Vd
\newcommand*{\VN}[1]{\gls{VN}\nobreakspace{}#1}% Vae&#977;a Nask
\newcommand*{\Vr}[1]{\gls{Vr}\nobreakspace{}#1}% Visparad
\newcommand*{\VrS}[1]{\gls{VrS}\nobreakspace{}#1}% Visperad Sade
\newcommand*{\VS}[1]{\gls{VS}\nobreakspace{}#1}% Videvdad Sade
\newcommand*{\Vyt}[1]{\gls{Vyt}\nobreakspace{}#1}% Vistasp Yast
\newcommand*{\VytS}[1]{\gls{VytS}\nobreakspace{}#1}% Vishtasp Yasht Sade
\newcommand*{\Y}[1]{\gls{Y}\nobreakspace{}#1}% Yasna
\newcommand*{\Yt}[1]{\gls{Yt}\nobreakspace{}#1}% Yast
\newcommand*{\YiR}[1]{\gls{YiR}\nobreakspace{}#1}% Yasna ī Rapihwin
\newcommand*{\YVr}[1]{\gls{YVr}\nobreakspace{}#1}% Yasna Visperad
\newcommand*{\Ygah}[1]{\gls{Ygah}\nobreakspace{}#1}% Yazisn-gah

\newcommand*{\aee}{ə\char"0304\relax}
\newcommand*{\XVE}{x\textsuperscript{v}}
\newcommand*{\NGVE}{ŋ\textsuperscript{v}}

\newcommand*{\AvA}{\symbol{"10B00}}
\newcommand*{\AvAA}{\symbol{"10B01}}
\newcommand*{\AvAO}{\symbol{"10B02}}
\newcommand*{\AvAAO}{\symbol{"10B03}}
\newcommand*{\AvAN}{\symbol{"10B04}}
\newcommand*{\AvAAN}{\symbol{"10B05}}
\newcommand*{\AvAE}{\symbol{"10B06}}
\newcommand*{\AvAEE}{\symbol{"10B07}}
\newcommand*{\AvE}{\symbol{"10B08}}
\newcommand*{\AvEE}{\symbol{"10B09}}
\newcommand*{\AvO}{\symbol{"10B0A}}
\newcommand*{\AvOO}{\symbol{"10B0B}}
\newcommand*{\AvI}{\symbol{"10B0C}}
\newcommand*{\AvII}{\symbol{"10B0D}}
\newcommand*{\AvU}{\symbol{"10B0E}}
\newcommand*{\AvUU}{\symbol{"10B0F}}
\newcommand*{\AvKE}{\symbol{"10B10}}
\newcommand*{\AvXE}{\symbol{"10B11}}
\newcommand*{\AvXYE}{\symbol{"10B12}}
\newcommand*{\AvXVE}{\symbol{"10B13}}
\newcommand*{\AvGE}{\symbol{"10B14}}
\newcommand*{\AvGGE}{\symbol{"10B15}}
\newcommand*{\AvGHE}{\symbol{"10B16}}
\newcommand*{\AvCE}{\symbol{"10B17}}
\newcommand*{\AvJE}{\symbol{"10B18}}
\newcommand*{\AvTE}{\symbol{"10B19}}
\newcommand*{\AvTHE}{\symbol{"10B1A}}
\newcommand*{\AvDE}{\symbol{"10B1B}}
\newcommand*{\AvDHE}{\symbol{"10B1C}}
\newcommand*{\AvTTE}{\symbol{"10B1D}}
\newcommand*{\AvPE}{\symbol{"10B1E}}
\newcommand*{\AvFE}{\symbol{"10B1F}}
\newcommand*{\AvBE}{\symbol{"10B20}}
\newcommand*{\AvBHE}{\symbol{"10B21}}
\newcommand*{\AvNGE}{\symbol{"10B22}}
\newcommand*{\AvNGYE}{\symbol{"10B23}}
\newcommand*{\AvNGVE}{\symbol{"10B24}}
\newcommand*{\AvNE}{\symbol{"10B25}}
\newcommand*{\AvNYE}{\symbol{"10B26}}
\newcommand*{\AvNNE}{\symbol{"10B27}}
\newcommand*{\AvME}{\symbol{"10B28}}
\newcommand*{\AvHME}{\symbol{"10B29}}
\newcommand*{\AvYYE}{\symbol{"10B2A}}
\newcommand*{\AvYE}{\symbol{"10B2B}}
\newcommand*{\AvVE}{\symbol{"10B2C}}
\newcommand*{\AvRE}{\symbol{"10B2D}}
\newcommand*{\AvLE}{\symbol{"10B2E}}
\newcommand*{\AvSE}{\symbol{"10B2F}}
\newcommand*{\AvZE}{\symbol{"10B30}}
\newcommand*{\AvSHE}{\symbol{"10B31}}
\newcommand*{\AvZHE}{\symbol{"10B32}}
\newcommand*{\AvSHYE}{\symbol{"10B33}}
\newcommand*{\AvSSHE}{\symbol{"10B34}}
\newcommand*{\AvHE}{\symbol{"10B35}}
\newcommand*{\AvAbbrev}{\symbol{"10B39}}
\newcommand*{\AvTTDOOD}{\symbol{"10B3A}}
\newcommand*{\AvSTDOOD}{\symbol{"10B3B}}
\newcommand*{\AvLTDOOD}{\symbol{"10B3C}}
\newcommand*{\AvLODOTD}{\symbol{"10B3D}}
\newcommand*{\AvLTROOR}{\symbol{"10B3E}}
\newcommand*{\AvLOROTR}{\symbol{"10B3F}}
%%% Special characters
%\newunicodechar{←}{{\freeserif\symbol{"2190}}}
%\newunicodechar{→}{{\freeserif\symbol{"2192}}}
\newunicodechar{〈}{\textlangle}% map U+2329 to U+27E8
\newunicodechar{〉}{\textrangle}% map U+232A to U+27E9
\newunicodechar{●}{{\freeserif\symbol{"25CF}}}
\newunicodechar{✓}{{\freeserif\symbol{"2713}}}
%%%
\newcommand*{\blackcircle}{●}
\renewcommand*{\checkmark}{✓}% from AMSmath
\newcommand*{\leftwardsarrow}{←}
\newcommand*{\rightwardsarrow}{→}
\newcommand*{\sectionsign}{§}
%%% remap from U+2329 to U+27E8 and from U+232A to U+27E9
\renewcommand*{\textlangle}{⟨}% U+27E8
\renewcommand*{\textrangle}{⟩}% U+27E9

\newcommand{\Newtranslation}[2]{\csgdef{translation-#1}{#2}}
\let\newtranslation\Newtranslation
\def\Gettranslation{\@ifstar\@Gettranslation\@@Gettranslation}
\newcommand{\@Gettranslation}[1]{%
   \bgroup%
   \let\AvTr\@gobble%
   \csuse{translation-#1}%
   \egroup%
}
\newcommand{\@@Gettranslation}[1]{\csuse{translation-#1}}
\let\gettranslation\Gettranslation
\newcommand{\AvTr}[1]{#1}
\newcommand{\Rd}[1]{#1}
%%%
\newif\if@usechapterref
\newcommand*{\Chapterref}[1]{\if@usechapterref\textsuperscript{\ref{#1}}\fi}
\let\chapterref\Chapterref
\newcommand*{\@abbreviationsfile}{../muya.common/abbreviations.tex}
\newcommand*{\SetAbbreviationsFile}[1]{\renewcommand*{\@abbreviationsfile}{#1}}
\newcommand*{\@translationsfile}{../muya.common/translations.tex}
\newcommand*{\SetTranslationsFile}[1]{\renewcommand*{\@translationsfile}{#1}}
%%\newcommand*{\@bibliographyfile}{../muya.common/zotero.bib}
%%\newcommand*{\SetBibliographyFile}[1]{\renewcommand*{\@bibliographyfile}{#1}}

\newcommand{\anklink}[2]{#1\hfill\Ank{#2}}


\NewEnviron{Dictionary}%
   {}[\directlua{sortGlossary()}\input{dictionaryconv}]%
% For the dictionary
\newlist{ModDictionary}{description}{1}
\setlist[ModDictionary]{%
   leftmargin=*,%
   font=\normalfont\bfseries\itshape%
}
%\newenvironment{Dictionary}{}{}
\newlist{Meanings}{enumerate*}{1}
\setlist[Meanings]{label=\arabic*.,mode=unboxed}
%
\newlist{Sublemmata}{description}{1}
\setlist[Sublemmata]{%
   left=2\parindent,%
   font=\normalfont\bfseries\itshape,%
   before={\def~{\textasciitilde}}%
}
\newlist{Subsublemmata}{description}{1}
\setlist[Subsublemmata]{%
   left=2\parindent,%
   font=\normalfont\bfseries\itshape,%
   before={\def~{\textasciitilde}}%
}
\newlist{Subsubsublemmata}{description}{1}
\setlist[Subsubsublemmata]{%
   left=2\parindent,%
   font=\normalfont\bfseries\itshape,%
   before={\def~{\textasciitilde}}%
}
\newcommand{\Meaning}[2][]{\item #2\ifstrempty{#1}{}{\ (#1)}}
\def\Sublemma{\@ifstar\@Sublemma\@@Sublemma}
\newcommand*{\@Sublemma}[1]{%
   \unskip\nobreakspace|\nobreakspace{}{\bfseries\itshape #1}}
\newcommand*{\@@Sublemma}[1]{\item[#1]\@firstattestationtrue}
%
\def\Subsublemma{\@ifstar\@Subsublemma\@@Subsublemma}
\newcommand*{\@Subsublemma}[1]{%
   \unskip\nobreakspace|\nobreakspace{}{\bfseries\itshape #1}}
\newcommand*{\@@Subsublemma}[1]{\item[#1]\@firstattestationtrue}
%
\def\Subsubsublemma{\@ifstar\@Subsubsublemma\@@Subsubsublemma}
\newcommand*{\@Subsubsublemma}[1]{%
   \unskip\nobreakspace|\nobreakspace{}{\bfseries\itshape #1}}
\newcommand*{\@@Subsubsublemma}[1]{\item[#1]\@firstattestationtrue}

\makeindex[%
   name=dictionary,%
   title={Index of Words},%
   columns=2,%
   columnsep=4mm,%
   options={--noheadings --config muya}   
   ]%
\newcommand{\Lemma}[1]{\item[#1]\@addtosequenceofletters{#1}}
%\newcommand{\cnt}{}
%\NewEnviron{Lemma}[1]{%
%   \@addtosequenceofletters{#1}
%   \renewcommand{\cnt}{}%
%   \gappto\cnt{\BODY}%
%}[\index[dictionary]{\cnt}]

\newcommand*{\Link}[1]{\unskip\nobreakspace\symbol{"2192}\,#1}

\newcommand{\AirWb}[1]{\textit{AirWb}\nobreakspace{}#1}
\newcommand{\Etym}[1]{#1}
\newcommand{\EWAia}[1]{\textit{EWAia}\nobreakspace{}#1}
\newcommand{\Reference}[1]{#1}
\newcommand{\Translation}[2][]{%
   \IfStrEqCase{#1}{%
      {Phlv}{Pahl.\,tr.:\nobreakspace{}}%
      {Sa}{Sanskrit tr.:\nobreakspace{}}%
   }[]%
\textit{#2}}%
\newcommand{\Stage}[1]{#1}
%%\newcommand{\Ved}[1]{#1}
\newcounter{attestation}
\def\Attestation{%
   \@ifstar{\stepcounter{attestation}\@attestation}%
      {\setcounter{attestation}{1}\@attestation}}
\newif\if@firstattestation
\newcommand{\@attestation}[2]{%
   \if@firstattestation
      \@firstattestationfalse%
   \else%
      \unskip\nobreakspace|\nobreakspace%
   \fi%
   \theattestation.\nobreakspace\textit{#1}\ #2}
\newcommand{\Pos}[1]{#1}

\gdef\@lastinitialletter{}
\gdef\@sequenceofletters{}
\gdef\@@sequenceofletters{}
\AfterEndEnvironment{Dictionary}{%
   \immediate\write\@auxout{\string\gdef\string\@sequenceofletters{\@@sequenceofletters}}}
\newcommand{\@addtosequenceofletters}[1]{%
   \StrLeft{#1}{1}[\@initialletter]
   \ifdefstrequal{\@initialletter}{\@lastinitialletter}
      {}
      {%
         \ifstr{\@@sequenceofletters}{}
            {\xappto\@@sequenceofletters{\@initialletter}}%
            {\xappto\@@sequenceofletters{, \@initialletter}}%
         \let\@lastinitialletter\@initialletter
      }%
}
\newcommand{\Sequenceofletters}{Sequence of 
letters:\\\@sequenceofletters\par\vspace{\baselineskip}\noindent}


\AtEndPreamble{%
   \InputIfFileExists{\@abbreviationsfile}%
      {\ClassInfo{brill}{Abbreviations successfully loaded!}}%
      {\ClassWarning{brill}{No abbreviation file found!\MessageBreak
       Please use \string\SetAbbreviationsFile\space}}%
   \InputIfFileExists{\@translationsfile}%
      {\ClassInfo{brill}{Translations successfully loaded!}}%
      {\ClassWarning{brill}{No translation file found!\MessageBreak
       Please use \string\SetTranslationsFile\space}}%
%   \IfFileExists{\@bibliographyfile}%
%      {\addbibresource{\@bibliographyfile}}%
%      {\ClassWarning{brill}{No bibliography file found!\MessageBreak
%       Please use \string\SetBibliographyFile\space}}%
}%

\endinput